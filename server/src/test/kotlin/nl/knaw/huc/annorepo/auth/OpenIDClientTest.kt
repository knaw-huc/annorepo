package nl.knaw.huc.annorepo.auth

import org.junit.jupiter.api.Test
import org.assertj.core.api.Assertions.assertThat

class OpenIDClientTest {

    @Test
    fun `recognize correct jwt`() {
        val validJwt =
            "eyJhbGciOiJFUzI1NiIsImtpZCI6ImJFRTFVRGRIWkhJM0WUm9VVzlXVG14bVZVaDFPRzFTYVZrNU5XNUVSRGRXUkhoVFNESkNlR2gyUVEifQ.eyJzY29wZSI6ICJvcGVuaWQgcHJvZlsZSBlbWFpbCBlZHVwZXJzb25fZW50aXRsZW1lbnQgdm9wZXJzb25fZXh0ZXJuYWxfaWQiLCAiYXVkIjogWyJBUFAtMkE0QTQxRjctM0EzQS00QzgxLUJFOEQtRjY1MERFOUI0NzdCIl0sICJqdGkiOiAiNDQzNzllNjBmYmZiNDgxOWIzMWMzOWJiMTZkMmM2YzYiLCAiY2xpZW50X2lkIjogIkFQUC0yQTRBNDFGNy0zQTNBLTRDODEtQkU4RC1GNjUwREU5QjQ3N0IiLCAic3ViIjogImU4MzNjMDBmODVmNWRkNGZiNjc0N2M1Y2UzZjUyNmFmYzU0ZGU4NGVAc3JhbS5zdXJmLm5sIiwgIm5hbWUiOiAiQnJhbSBCdWl0ZW5kaWprIiwgImdpdmVuX25hbWUiOiAiQnJhbSIsICJmYW1pbHlfbmFtZSI6ICJCdWl0ZW5kaWprIiwgImVtYWlsIjogImJyYW0uYnVpdGVuZGlqa0BkaS5odWMua25hdy5ubCIsICJlZHVwZXJzb25fZW50aXRsZW1lbnQiOiBbInVybjptYWNlOnN1cmYubmw6c3JhbTpncm91cDprbmF3OnRlc3RfYW5ub3JlcG86c3Nob2Nfbmxfcm9sb2RleC1nZW5lcmFsIiwgInVybjptYWNlOnN1cmYubmw6c3JhbTpncm91cDprbmF3OnRlc3RfYW5ub3JlcG8iLCAidXJuOm1hY2U6c3VyZi5ubDpzcmFtOmdyb3VwOmtuYXc6dGVzdF9hbm5vcmVwbzphZG1pbiIsICJ1cm46bWFjZTpzdXJmLm5sOnNyYW06Z3JvdXA6a25hdyIsICJ1cm46bWFjZTpzdXJmLm5sOnNyYW06Z3JvdXA6c3VyZi1yYW0jc3JhbS5zdXJmLm5sIl0sICJ2b3BlcnNvbl9leHRlcm5hbF9pZCI6IFsiYnJhbS5idWl0ZW5kaWprQGRpLmh1Yy5rbmF3Lm5sIl0sICJzaWQiOiAiWjBGQlFVRkJRbTlsVWtOdFdGcHpkRnBaYmpGaU5uWjBSbEl4TUU1T05sOUxWRFZEYWtaSk16RklZMU4xT0ZGck0yUnpiR1kxTFVRMVpEUkxjVUV5Vms5RFkxRnhUbmgxYTFsNFZUaDRSRTVvZGtkNE9VRkJNbU5qTms5b2RHNHdiV2xwZUVGSFNXVkVRMlJ6T0V0TmEwdDFjemszT0dSVVdEUlNjRXN3U2xRd1dVSlVPV3BETFROS2VtZzRNMWsxUlZkM1ExZDJOSFl0Wld0TGNFNWhVSFJ3YVZkWGNIVXdlbmhWWTJ0YVZGcFVTVE5RVXpsMWVtWm5TbkJJY0dGb1dVZEVNR1p5VFhZMlUzRm9aRkJtTmpSeWFrZGFWVkZQVDJWV1JVTlFVa0pHT1VKbFZHZHJka2w1T1RGUFNtOW9ORXRuWWpGMFIwUm9WalpOUkRWS2FqZFViV0k0TFU1U1RubDNlbFJHZEVGVFVXbE5iWEZhVldsVmFtVkpRMkZFY2s5Qk1HWlRXR2d4ZGkxUVYzTjJNamxxZGpkVWJVNWpaRXBNVFZaWlgyY3lVV1JUWm1veFpEQk5lbVJHZFZJMFprWktibll5VmxsMU5GWnFOVGxMVm1sUlBUMD0iLCAidG9rZW5fY2xhc3MiOiAiYWNjZXNzX3Rva2VuIiwgImlzcyI6ICJodHRwczovL3Byb3h5LnNyYW0uc3VyZi5ubCIsICJpYXQiOiAxNzUyNzY0NTgzLCAiZXhwIjogMTc1Mjc2ODE4M30.VTe_FH0o3Cm5UqVWMCdVDe7tGzG_qy4RMpJnzwMHKKDKGugSjBwgA0WE9ckUx1T4IRr1lKqs_96pH5B96dpwQ"
        assertThat(validJwt.isJWT()).isTrue
    }

    @Test
    fun `recognize incorrect jwt`() {
        val invalidJwt = "whatever"
        assertThat(invalidJwt.isJWT()).isFalse
    }

    private fun String?.isJWT(): Boolean = this?.count { it == '.' } == 2

}

